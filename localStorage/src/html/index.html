<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
	<meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no">
	<title>手品之美vivo X5Pro</title>
    <link rel="stylesheet" href="../css/style-promo.css"/>
    <style>
        html, body {
            height: 100%;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            overflow: hidden;
            background-color: #070709;
        }

        .loading{
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #070709;
        }

        .loading__inner{
            position: absolute;
            left: 50%;
            top: 50%;
            margin-left: -26px;
            margin-top: -16px;
            width: 52px;
            height: 32px;
            text-align: center;
            color: #666;
            font-size: 12px;
            background-color: #070709;
        }

        .loading__img{
            width: 52px;
            height: 32px;
            background: url(../img/loading.png) no-repeat;
            background-size: 52px auto;
        }

        .loading-num{
            position: absolute;
            left: 0;
            bottom: -10px;
            width: 100%;
            text-align: center;
        }

    </style>
</head>
<body>
<div class="loading">
    <div class="loading__inner">
        <div class="loading__img"></div>
        <div class="loading-num">0%</div>
    </div>
</div>

<!--容器-->
<div class="wrap" style="display: none">
    <section class="screen screen1">
        <div class="screen__bg screen1__bg"></div>
        <div class="screen__inner">
            <div class="screen__txt-wrap">
                <div class="screen__txt screen1__txt1"></div>
                <div class="screen__txt screen1__txt2"></div>
            </div>
            <div class="screen__icon screen1__icon"></div>
            <div class="screen__txt screen1__txt3"></div>
            <div class="screen__txt screen1__txt4"></div>
            <div class="screen1__pic1"></div>
            <div class="screen1__pic2"></div>
            <div class="screen-arrow screen-arrow1"></div>
        </div>
    </section>
    <section class="screen screen2">
        <div class="screen__bg screen2__bg"></div>
        <div class="screen__inner">
            <div class="screen__txt-wrap">
                <div class="screen__txt screen2__txt1"></div>
                <div class="screen__txt screen2__txt2"></div>
            </div>
            <div class="screen__icon screen2__icon"></div>
            <div class="screen__txt screen2__txt3"></div>
            <div class="screen__txt screen2__txt4"></div>
            <div class="screen2__pic1"></div>
            <div class="scree2__mo">
                <div class="screen2__pic2"></div>
                <div class="screen2__pic3"></div>
                <div class="screen2__pic4"></div>
            </div>
            <div class="screen2__pic5"></div>
            <div class="screen-arrow screen-arrow2"></div>
        </div>
    </section>
    <section class="screen screen3">
        <div class="screen__bg screen3__bg"></div>
        <div class="screen__inner">
            <div class="screen__txt-wrap">
                <div class="screen__txt screen3__txt1"></div>
                <div class="screen__txt screen3__txt2"></div>
            </div>
            <div class="screen__icon screen3__icon"></div>
            <div class="screen__txt screen3__txt3"></div>
            <div class="screen__txt screen3__txt4"></div>
            <div class="screen3__pic1"></div>
            <div class="logo"></div>
            <div class="screen-arrow"></div>
        </div>
    </section>
    <section class="screen screen4">
        <div class="screen__bg screen4__bg"></div>
        <div class="screen__inner">
            <div class="screen__txt-wrap">
                <div class="screen__txt screen4__txt1"></div>
                <div class="screen__txt screen4__txt2"></div>
            </div>
            <div class="screen__icon screen4__icon"></div>
            <div class="screen__txt screen4__txt3"></div>
            <div class="screen__txt screen4__txt4"></div>
            <div class="screen__pic-wrap">
                <div class="screen4__pic1"></div>
                <div class="screen4__pic-circle">
                    <div class="screen4__pic2"></div>
                    <div class="screen4__pic3"></div>
                    <div class="screen4__pic4"></div>
                    <div class="screen4__pic5"></div>
                    <div class="screen4__pic6"></div>
                    <div class="screen4__pic7"></div>
                    <div class="screen4__pic8"></div>
                </div>
            </div>
            <div class="screen-arrow"></div>
        </div>
    </section>
    <section class="screen screen5">
        <div class="screen__inner">
            <div class="screen5__txt1"></div>
            <div class="screen5__txt2"></div>
            <div class="screen5__txt3"></div>
            <div class="screen5__pic1"></div>
            <div class="screen5__txt4"></div>
            <div class="screen__btn"><a id="J-btn" href="http://wx.vivo.com.cn/x5pro/card"></a></div>
        </div>
    </section>
</div>
<script src="http://cdnjs.gtimg.com/cdnjs/libs/wxmoment/0.0.2-rc2/wxmoment.min.js"></script>
<script>

    var Loader = (function () {
        function Loader(options) {
            this.options = options;
            if (resource.scripts && resource.baseUrl) {
                if(this.options.scripts){
                    for (var i = 0; i < this.options.scripts.length; i++) {
                        this.load('js', this.options.scripts[i]);
                    }
                }
                if(this.options.stylesheets){
                    for (var i = 0; i < this.options.stylesheets.length; i++) {
                        this.load('css', this.options.stylesheets[i]);
                    }
                }
            } else {
                console.log('初始化参数错误');
            }
        }

        Loader.prototype.load = function (type, obj) {
            var _this = this;
            if (window.localStorage) {
                // 判断 localStorage 中是否已经有缓存
                var hasLocal = typeof localStorage[obj.key] !== "undefined";
                var fileUrl = obj.isAbsolute ? obj.file : this.options.baseUrl + obj.file;

                //有缓存且版本相等
                if (hasLocal && JSON.parse(localStorage[obj.key])["ver"] === obj.file) {
                    //设为已加载
                    obj.isLoad = true;

                    this.append(type, obj.file, 'inline');

                } else {
                    //版本号不相等
                    //清空 localstorage
                    localStorage.removeItem(obj.key);

                    //加载
                    this.requestResource(fileUrl, function (url, content) {
                        //设为已加载
                        obj.isLoad = true;

                        if (type === "css") {
                            content = content.replace(/(?:url\('?"?(.*?)'?"?\))/g, 'url("' + url.substring(0, url.lastIndexOf('/')) + '/$1")');
                        }

                        //保存到 localStorage 中
                        localStorage[obj.key] = JSON.stringify({
                            ver: obj.file,
                            data: content
                        });

                        //append
                        _this.append(type, obj.file, 'inline');
                    })
                }
            } else {
                //不支持 localStorage, 用传统的方式加载
                this.append(type, obj.file, 'url', fileUrl);
            }
        };

        // 插入资源
        // fileExtension: css/js
        // file: scripts/main_xxx.js
        // loadtype: inline/url
        // content:  inline 时, 需要插入的内容, url 时为 需要请求的完整 URL
        Loader.prototype.append = function (fileExtension, file, loadType, content) {
            if (fileExtension === "js") {
                if (loadType == "inline") {
                    //for 判断文件是否加载好
                    for (var i = 0; i < this.options.scripts.length; i++) {
                        var item = this.options.scripts[i];
                        if (item.isLoad && !item.isAppended) {
                            var s = document.createElement('script');
                            s.innerHTML = JSON.parse(window.localStorage[item.key])['data'];
                            document.head.appendChild(s);
                            item.isAppended = true;
                        } else if (!item.isLoad) {
                            break;
                        }
                    }
                } else if (loadType === 'url') {
                    var head = document.getElementsByTagName("head")[0] || document.documentElement;
                    var script = document.createElement("script");
                    script.src = content;
                    head.insertBefore(script, head.firstChild);
                }
            } else if (fileExtension === "css") {
                if (loadType == "inline") {
                    for (var i = 0; i < this.options.stylesheets.length; i++) {
                        var item = this.options.stylesheets[i];
                        if (item.isLoad && !item.isAppended) {
                            var s = document.createElement('style');
                            s.innerHTML = JSON.parse(window.localStorage[item.key])['data'];
                            document.head.appendChild(s);
                            item.isAppended = true;
                        } else if (!item.isLoad) {
                            break;
                        }
                    }
                } else if (loadType === 'url') {
                    var s = document.createElement('link');
                    s.href = content;
                    document.head.appendChild(s);
                }
            }
        };

        Loader.prototype.requestResource = function (url, success, error) {
            var request = new XMLHttpRequest();
            request.open('GET', url, true);

            request.onload = function () {
                if (request.status >= 200 && request.status < 400) {
                    var resp = request.responseText;
                    success(url, resp)
                } else {
                    if (typeof error === 'function') {
                        error(url);
                    }
                }
            };
            request.send();
        };

        return Loader;

    })();


    //baseUrl 文件
    //key 为在 LocalStorage 中的 key 名称
    //version 为内容名称,同步也是 content 中保存的
    var resource = {
        baseUrl: "./",
        // stylesheets: [
        //     {
        //         key: "css/style-jingqu_css",
        //         file: "//wximg.gtimg.com/tmt/city-jingqu/dist/css/style-jingqu.css?v=20150721",
        //         isAbsolute: true
        //     }
        // ],
        scripts: [
            {key: "scripts/vendor_js", file: "../js/other.js"},
            {key: "scripts/app_js", file: "../js/main.js"}
        ]
    };

    var loader = new Loader(resource);
</script>

</body>
</html>
